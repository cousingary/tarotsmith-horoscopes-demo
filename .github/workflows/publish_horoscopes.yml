# publish_horoscopes.yml
# ----------------------
# Triggers every Sunday at 15:33 Bangkok time (08:33 UTC).
# Posts 24 horoscope pages to WordPress via REST API.
# Runs before weekly_update.yml to ensure sign pages are live
# before the index is updated.

name: Publish Horoscopes to WordPress

on:
  schedule:
    - cron: '33 8 * * 0'
  workflow_dispatch:
    inputs:
      week:
        description: 'week_start to post (YYYY-MM-DD)'
        required: false
        default: ''
      dry_run:
        description: 'Dry run without touching WordPress (true/false)'
        required: false
        default: 'false'

jobs:
  publish:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      - run: pip install requests
      - name: Post to WordPress
        env:
          WP_URL: ${{ vars.WP_URL || 'https://horoscopes.tarotsmith.com' }}
          WP_USERNAME: master-d
          WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
        run: python post_to_wordpress.py ${{ github.event.inputs.dry_run == 'true' && '--dry-run' || '' }} ${{ github.event.inputs.week && format('--week {0}', github.event.inputs.week) || '' }}
